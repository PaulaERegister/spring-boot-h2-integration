<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<form th:object="${order}" method="post">
    <label for="date">Date</label>
    <input th:field="*{date}">

    <fieldset id="items">
        <div th:each=", stat : ${order.items}">
            <label th:for="|order.items[${stat.index}].name|">Name</label>
            <!-- This construct will render field name like this: "items[0].name" -->
            <input th:field="${order.items[__${stat.index}__].name}">

            <button type="button" name="removeItem" th:value="${stat.index}">Remove item</button>
        </div>
    </fieldset>

    <button type="button" name="addItem">Add item</button>

    <input type="submit" name="save" value="Save">
</form>
</body>
<script>
    // jQuery
    function replaceItems (html) {
        // Replace the <fieldset id="items"> with a new one returned by server.
        $('#items').replaceWith($(html));
    }

    $('button[name="addItem"]').click(function (event) {
        event.preventDefault();
        var data = $('form').serialize();
        // Add parameter "addItem" to POSTed form data. Button's name and value is
        // POSTed only when clicked. Since "event.preventDefault();" prevents from
        // actual clicking the button, following line will add parameter to form
        // data.
        data += 'addItem';
        $.post('/order', data, replaceItems);
    });

    $('button[name="removeItem"]').click(function (event) {
        event.preventDefault();
        var data = $('form').serialize();
        // Add parameter and index of item that is going to be removed.
        data += 'removeItem=' + $(this).val();
        $.post('/order', data, replaceItems);
    });
</script>
</html>
